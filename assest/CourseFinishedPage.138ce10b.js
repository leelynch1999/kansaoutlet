import{s as n,ai as Y,q as a,o as E,Y as J}from"./vendor.d944feed.js";import{v as y,E as w,M as K,c as l,u as R,a as B,e as O,C as Q,k as X,R as Z}from"./index.fac359f5.js";import{u as I,N as _,F as M,I as D}from"./useFocusState.b50e5672.js";import{F as P,a as j,T as q,B as G}from"./Button.5439cc8b.js";const u={MissingData:{Header:"CourseFinished.MissingData.Header",FirstName:{Invalid:"CourseFinished.MissingData.FirstName.Invalid",Label:"CourseFinished.MissingData.FirstName.Label"},LastName:{Invalid:"CourseFinished.MissingData.LastName.Invalid",Label:"CourseFinished.MissingData.LastName.Label"},Submit:{Label:"CourseFinished.MissingData.Submit.Label"}},Register:{Header:"CourseFinished.Register.Header",Controls:{Submit:{Label:"CourseFinished.Register.Controls.Submit.Label"},ExistingAccount:{Label:"CourseFinished.Register.Controls.ExistingAccount.Label"}}},Login:{Header:"CourseFinished.Login.Header",Email:{Label:"CourseFinished.Login.Email.Label"},Password:{Label:"CourseFinished.Login.Password.Label"},Controls:{Submit:{Label:"CourseFinished.Login.Controls.Submit.Label"},CreateAccount:{Label:"Register.Controls.CreateAccount.Label"}}}};function z(e){const[t,m]=n.exports.useState(""),[s,r]=n.exports.useState(""),[d,o]=n.exports.useState(null),C=y(t,s,!0)===null,g=d?.find(i=>i.type===w.Password),h=d?.find(i=>i.type===w.Email),f=d?.find(i=>i.type===w.Global),[b,k,v]=I(),[S,H,F]=I(),[L,N]=n.exports.useState(!1),x=Y(),U=n.exports.useCallback(i=>{m(i.target.value),o(y(i.target.value,s,!0))},[s]),A=n.exports.useCallback(i=>{r(i.target.value),o(y(t,i.target.value,!0))},[t]),T=n.exports.useCallback(i=>{i.preventDefault(),x.push(e.nextUrl)},[x,e.nextUrl]),c=n.exports.useCallback(async i=>{if(i.preventDefault(),!L&&y(t,s,!0)===null){N(!0);try{await e.onSubmit(t,s)}catch(V){console.error("Failed to submit account form",V),o([{message:K.Error.Incorrect.Global,type:w.Global}])}finally{N(!1)}}},[t,L,e,s]);return a(P,{width:"100vw",height:"100vh",justifyContent:"center",alignItems:"center",flexFlow:"column",children:E(j,{width:400,children:[a(q,{variant:"header-1",margin:"base",align:"center",children:a(l,{id:e.header})}),E(j,{boxShadow:"card",borderRadius:"base",background:"cloud",padding:"md",tag:"form",onSubmit:c,children:[f?a(_,{variant:"error",description:a(l,{id:f.message}),marginBottom:25}):null,a(M,{id:"login",label:a(l,{id:u.Login.Email.Label}),isInvalid:Boolean(!b&&!!h),error:!b&&h?a(l,{id:h.message}):null,children:a(D,{type:"email",autoComplete:"email",onChange:U,value:t,onFocus:k,onBlur:v})}),a(M,{id:"pwd",label:a(l,{id:u.Login.Password.Label}),isInvalid:Boolean(!S&&!!g),error:!S&&g?a(l,{id:g.message}):null,children:a(D,{type:"password",autoComplete:e.pwdMode,onChange:A,value:s,onFocus:H,onBlur:F})}),a(G,{type:"submit",width:"100%",isDisabled:!C,isLoading:L,children:a(l,{id:e.submit})})]}),a(P,{marginTop:"sm",justifyContent:"left",alignItems:"start",width:"100%",children:a(G,{variant:"ghost",size:"small",marginLeft:0,tag:"a",href:e.nextUrl,onClick:T,children:a(l,{id:e.navigate})})})]})})}function W(e){if(typeof location>"u")return"/";const t=new URL(location.href);return t.searchParams.set("f",e?"0":"1"),t.pathname+t.search}function $(){const e=R(),t=B(),m=n.exports.useCallback(async(s,r)=>{(await e.member.login(s,r,!0)).ensureSuccess(),await t.forceRefresh()},[e.member,t]);return a(z,{header:u.Login.Header,submit:u.Login.Controls.Submit.Label,navigate:u.Login.Controls.CreateAccount.Label,onSubmit:m,nextUrl:W(!1),pwdMode:"current-password"},"login")}function ee(){const e=R(),t=B(),m=n.exports.useCallback(async(s,r)=>{(await e.member.create({email:s,password:r})).ensureSuccess(),await t.forceRefresh()},[e.member,t]);return a(z,{header:u.Register.Header,submit:u.Register.Controls.Submit.Label,navigate:u.Register.Controls.ExistingAccount.Label,onSubmit:m,nextUrl:W(!0),pwdMode:"new-password"},"register")}function p(e,t,m,s){const r=[];return m&&e.trim().length<2&&r.push({message:u.MissingData.FirstName.Invalid,type:w.Email}),s&&t.trim().length<2&&r.push({message:u.MissingData.LastName.Invalid,type:w.Password}),r.length===0?null:r}function ae(e){const[t,m]=n.exports.useState(""),[s,r]=n.exports.useState(""),[d,o]=n.exports.useState(null),C=p(t,s,e.showFirstName,e.showLastName)===null,g=d?.find(c=>c.type===w.Password),h=d?.find(c=>c.type===w.Email),[f,b,k]=I(),[v,S,H]=I(),[F,L]=n.exports.useState(!1),N=R(),x=B(),U=n.exports.useCallback(c=>{m(c.target.value),o(p(c.target.value,s,e.showFirstName,e.showLastName))},[s,e.showFirstName,e.showLastName]),A=n.exports.useCallback(c=>{r(c.target.value),o(p(t,c.target.value,e.showFirstName,e.showLastName))},[t,e.showFirstName,e.showLastName]),T=n.exports.useCallback(async c=>{if(c.preventDefault(),!F&&p(t,s,e.showFirstName,e.showLastName)===null){L(!0);try{const i={};e.showFirstName&&(i.firstName=t),e.showLastName&&(i.lastName=s),(await N.member.update(i)).ensureSuccess(),await x.forceRefresh()}catch(i){console.error("Failed to update member",i)}finally{L(!1)}}},[N.member,t,F,s,x,e.showFirstName,e.showLastName]);return a(P,{width:"100vw",height:"100vh",justifyContent:"center",alignItems:"center",flexFlow:"column",children:E(P,{width:500,alignItems:"center",flexFlow:"column",children:[a(q,{variant:"header-1",margin:"base",align:"center",children:a(l,{id:u.MissingData.Header})}),E(j,{boxShadow:"card",borderRadius:"base",background:"cloud",padding:"md",tag:"form",onSubmit:T,width:400,children:[e.showFirstName?a(M,{id:"firstname",label:a(l,{id:u.MissingData.FirstName.Label}),isInvalid:Boolean(!f&&!!h),error:!f&&h?a(l,{id:h.message}):null,children:a(D,{autoComplete:"given-name",onChange:U,value:t,onFocus:b,onBlur:k})}):null,e.showLastName?a(M,{id:"lastname",label:a(l,{id:u.MissingData.LastName.Label}),isInvalid:Boolean(!v&&!!g),error:!v&&g?a(l,{id:g.message}):null,children:a(D,{autoComplete:"family-name",onChange:A,value:s,onFocus:S,onBlur:H})}):null,a(G,{type:"submit",width:"100%",isDisabled:!C,isLoading:F,children:a(l,{id:u.MissingData.Submit.Label})})]})]})})}function re(e){const[t,m]=n.exports.useState(null),s=R(),r=J(O),d=B(),[o,C]=n.exports.useState(null),[g,h]=n.exports.useState(d.isLoggedIn!==null),f=n.exports.useMemo(()=>t?{user:o,course:t}:null,[t,o]);return n.exports.useEffect(()=>{(async()=>{const b=await s.courses.getById(r,e.match.params.slug);b.ensureSuccess(),m(await b.json())})()},[s.courses,e.match.params.slug,r]),n.exports.useEffect(()=>d.subscribe(b=>{C(b),h(!0)},()=>{C(null),h(!0)}),[d]),!f||!g?a(Q,{}):o?!o.firstName||!o.lastName?a(ae,{showFirstName:!o.firstName,showLastName:!o.lastName}):a(X.Provider,{value:f,children:a(Z,{...e})}):new URLSearchParams(e.location.search).get("f")==="1"?a(ee,{}):a($,{})}export{re as default};
