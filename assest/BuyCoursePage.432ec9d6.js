import{s as n,q as s,o as T,aj as O,Y as G,X as J,w as Q}from"./vendor.d944feed.js";import{u as z,E as j,a as H,v as R,M as V,L as K,c as S,d as Z,g as W,H as B,e as X,f as Y,b as _,h as ee,i as te,C as ae,T as k,j as re}from"./index.fac359f5.js";import{u as se,N as ne,F as q,I as M}from"./useFocusState.b50e5672.js";import{F as oe,B as ie}from"./Button.5439cc8b.js";const y={Product:{Headline:"BuyCourse.Product.Headline"},Help:{Label:"BuyCourse.Help.Label"},Form:{Email:{Label:"BuyCourse.Form.Email.Label",Errors:{Invalid:"BuyCourse.Form.Email.Errors.Invalid"}},Password:{Label:"BuyCourse.Form.Password.Label"},Submit:{CreateAccount:{Label:"BuyCourse.Form.Submit.CreateAccount.Label"},Login:{Label:"BuyCourse.Form.Submit.Login.Label"}},Errors:{PaymentClaim:{Message:"BuyCourse.Form.Errors.PaymentClaim.Message"}}}};/*!
 * paypal-js v7.0.0 (2023-08-16T16:58:51.809Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ce(e,t){var a=document.querySelector('script[src="'.concat(e,'"]'));if(a===null)return null;var r=U(e,t),o=a.cloneNode();if(delete o.dataset.uidAuto,Object.keys(o.dataset).length!==Object.keys(r.dataset).length)return null;var c=!0;return Object.keys(o.dataset).forEach(function(i){o.dataset[i]!==r.dataset[i]&&(c=!1)}),c?a:null}function le(e){var t=e.url,a=e.attributes,r=e.onSuccess,o=e.onError,c=U(t,a);c.onerror=o,c.onload=r,document.head.insertBefore(c,document.head.firstElementChild)}function ue(e){var t="https://www.paypal.com/sdk/js";e.sdkBaseUrl&&(t=e.sdkBaseUrl,delete e.sdkBaseUrl);var a=e,r=Object.keys(a).filter(function(i){return typeof a[i]<"u"&&a[i]!==null&&a[i]!==""}).reduce(function(i,u){var m=a[u].toString();return u=de(u),u.substring(0,4)==="data"?i.dataAttributes[u]=m:i.queryParams[u]=m,i},{queryParams:{},dataAttributes:{}}),o=r.queryParams,c=r.dataAttributes;return o["merchant-id"]&&o["merchant-id"].indexOf(",")!==-1&&(c["data-merchant-id"]=o["merchant-id"],o["merchant-id"]="*"),{url:"".concat(t,"?").concat(me(o)),dataAttributes:c}}function de(e){var t=function(a,r){return(r?"-":"")+a.toLowerCase()};return e.replace(/[A-Z]+(?![a-z])|[A-Z]/g,t)}function me(e){var t="";return Object.keys(e).forEach(function(a){t.length!==0&&(t+="&"),t+=a+"="+e[a]}),t}function U(e,t){t===void 0&&(t={});var a=document.createElement("script");return a.src=e,Object.keys(t).forEach(function(r){a.setAttribute(r,t[r]),r==="data-csp-nonce"&&a.setAttribute("nonce",t["data-csp-nonce"])}),a}function fe(e,t){if(t===void 0&&(t=Promise),$(e,t),typeof document>"u")return t.resolve(null);var a=ue(e),r=a.url,o=a.dataAttributes,c=o["data-namespace"]||"paypal",i=D(c);return ce(r,o)&&i?t.resolve(i):pe({url:r,attributes:o},t).then(function(){var u=D(c);if(u)return u;throw new Error("The window.".concat(c," global variable is not available."))})}function pe(e,t){t===void 0&&(t=Promise),$(e,t);var a=e.url,r=e.attributes;if(typeof a!="string"||a.length===0)throw new Error("Invalid url.");if(typeof r<"u"&&typeof r!="object")throw new Error("Expected attributes to be an object.");return new t(function(o,c){if(typeof document>"u")return o();le({url:a,attributes:r,onSuccess:function(){return o()},onError:function(){var i=new Error('The script "'.concat(a,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return c(i)}})})}function D(e){return window[e]}function $(e,t){if(typeof e!="object"||e===null)throw new Error("Expected an options object.");if(typeof t<"u"&&typeof t!="function")throw new Error("Expected PromisePonyfill to be a function.")}const ge=750;var E=(e=>(e[e.Login=0]="Login",e[e.Register=1]="Register",e))(E||{});function he(e){const t=z(),[a,r]=n.exports.useState(null),[o,c]=n.exports.useState(""),[i,u]=n.exports.useState(null),[m,F,x]=se(),[w,P]=n.exports.useState(!1),v=i?.find(h=>h.type===j.Password),C=i?.find(h=>h.type===j.Global),f=e.mode===0,d=a?.email??e.loginEmail??"",N=n.exports.useRef(!1),I=H(),[l,p]=n.exports.useState(!1),L=R(d,o,!0)===null,g=n.exports.useCallback(h=>{c(h.target.value),u(R(d,h.target.value,!0))},[d]),b=n.exports.useCallback(async h=>{if(h.preventDefault(),!w&&!R(d,o,!0)){P(!0);try{if(!N.current)try{(await(f?t.member.login(d,o,!0):t.member.create({email:d,password:o,firstName:a.firstName??void 0,lastName:a.lastName??void 0,countryCode:a.countryCode??void 0}))).ensureSuccess(),await I.forceRefresh(),N.current=!0}catch(A){console.error("Failed to create an account",A),u([{message:V.Error.Incorrect.Global,type:j.Global}]);return}try{(await t.courses.claimPayment(e.courseId,e.claimId)).ensureSuccess(),e.navigateToCourse.call(null),p(!0)}catch(A){console.error("Failed to claim payment",A),u([{message:y.Form.Errors.PaymentClaim.Message,type:j.Global}])}}finally{P(!1)}}},[I,w,d,o,f,t.member,t.courses,a,e.courseId,e.claimId,e.navigateToCourse]);return n.exports.useEffect(()=>{!e.claimId||(async()=>{const h=await t.courses.getDetailsFromClaimId(e.courseId,e.claimId);h.ensureSuccess(),r(await h.json())})()},[t.courses,e.claimId,e.courseId]),!d||l?s(K,{}):T("form",{onSubmit:b,children:[C?s(ne,{variant:"error",description:s(S,{id:C.message}),marginBottom:25}):null,s(q,{id:"email",label:s(S,{id:y.Form.Email.Label}),children:s(M,{isDisabled:!0,value:a?.email??e.loginEmail,autoComplete:"email"})}),s(q,{id:"password",label:s(S,{id:y.Form.Password.Label}),isInvalid:Boolean(!m&&!!v),error:!m&&v?s(S,{id:v.message}):null,children:s(M,{type:"password",autoComplete:f?"password":"new-password",required:!0,value:o,onChange:g,onFocus:F,onBlur:x})}),s(oe,{justifyContent:"center",children:s(ie,{type:"submit",isLoading:w,isDisabled:i!==null||!L,children:s(S,{id:f?y.Form.Submit.Login.Label:y.Form.Submit.CreateAccount.Label})})})]})}function be(e){const t=z(),a=e.user!==null,[r,o]=n.exports.useState(e.user?.email??""),[c,i]=n.exports.useState(null),u=n.exports.useRef(null),m=n.exports.useRef(r),[F,x]=n.exports.useState(!1),[w,P]=n.exports.useState(null),v=n.exports.useRef(null),C=Z(),f=n.exports.useCallback(l=>{const p=l.target.value;o(l.target.value),p.length===0||/^\S+@\S+.\w$/.test(p)?(m.current=l.target.value.trim(),i(null)):i(y.Form.Email.Errors.Invalid)},[]),d=n.exports.useCallback(()=>x(!0),[]),N=n.exports.useCallback(()=>x(!1),[]),I=n.exports.useCallback((l,p)=>{const L=new URL(O(W("course-buy-page-finalize"),{courseId:e.course.id,claimId:l}),document.location.origin);L.searchParams.set("m",p.toString()),C.navigate(L.pathname+L.search)},[C,e.course.id]);return n.exports.useEffect(()=>{let l=null;return(async()=>{const L=(await fe({clientId:"Acs-4TMIsb6k7MQthPIJv4eN4VAsi0LwV8k7uqLvJw6QShVzibJCvk2sqNLzdiMh-5dQte8fd0JjGrRs",currency:e.course.price.currency})).Buttons({fundingSource:"paypal",style:{color:"blue",label:"pay"},onInit(g,b){a||b.disable(),P(b)},onClick(){m.current.trim()||i(y.Form.Email.Errors.Invalid)},async createOrder(){const g=await t.courses.createPayPalOrder(e.course.id,a?null:m.current);if(g.status===B.Conflict){e.onLoginNeeded.call(null,m.current);return}else if(g.status===B.ExpectationFailed){e.navigateToCourse.call(null);return}else if(g.status===B.PreconditionRequired||g.status===B.PaymentRequired){const h=await g.json();I(h.claimId,g.status===B.PaymentRequired?E.Login:E.Register);return}g.ensureSuccess();const b=await g.json();return v.current=b,b.id},async onApprove(g){const b=await t.courses.capturePayPalOrder(e.course.id,g.orderID);b.ensureSuccess(),a?e.navigateToCourse.call(null):I(v.current.claimId,b.status===B.Accepted?E.Login:E.Register)}});l=()=>L.close,await L.render(u.current)})(),()=>l?.()},[t.courses,a,C,e.course.id,e.course.price,e.navigateToCourse,e.onLoginNeeded,I]),n.exports.useEffect(()=>{a||(c||!r?w?.disable():w?.enable())},[c,r,a,w]),T("section",{children:[s(q,{id:"email",label:s(S,{id:y.Form.Email.Label}),error:!F&&c?s(S,{id:c}):null,isInvalid:Boolean(!F&&!!c),maxWidth:ge,children:s(M,{type:"email",onChange:f,value:r,isDisabled:a,onFocus:d,onBlur:N,required:!0,autoComplete:"email"})}),s("div",{ref:u})]})}function Ee(e){const t=z(),a=H(),[r,o]=n.exports.useState(null),[c,i]=n.exports.useState(a.isLoggedIn??!1),[u,m]=n.exports.useState(null),F=G(X),x=Y(),w=_(),[P,v]=n.exports.useState(a.isLoggedIn??!1),C=ee(l=>l.settings.businessInformation.email),f=n.exports.useCallback(()=>window.location.replace(O(W("course-page"),{courseId:e.match.params.courseId})),[e.match.params.courseId]),[d,N]=n.exports.useState(null),I=n.exports.useMemo(()=>d?E.Login:e.match.params.claimId?new URLSearchParams(e.location.search).get("m")===E.Login.toString()?E.Login:E.Register:null,[d,e.location.search,e.match.params.claimId]);return n.exports.useEffect(()=>{(async()=>{const l=await t.courses.getById(F,e.match.params.courseId);l.ensureSuccess();const p=await l.json();if(p.paymentType===te.Free||p.price===null){f();return}o(p)})()},[t.courses,f,e.match.params.courseId,F]),n.exports.useEffect(()=>a.subscribe(()=>i(!0),()=>i(!0)),[a]),n.exports.useEffect(()=>a.subscribe(m,()=>m(null)),[a]),n.exports.useEffect(()=>{u!==null&&(v(!0),(async()=>{const l=await t.courses.checkAccess(e.match.params.courseId);if(l.ensureSuccess(),await l.json()){f();return}v(!1)})())},[t.courses,u,f,e.match.params.courseId]),!r||!c||P?s(ae,{}):T(xe,{$paragraph:x.paragraph,children:[s(ye,{}),s("article",{className:"items",children:T("div",{className:"details-container",children:[s(k,{$design:x.subheader,as:"h4",className:"headline",children:s(S,{id:y.Product.Headline})}),s("div",{className:"img",children:r.visualImage?s("img",{src:r.visualImage,alt:r.name}):null}),T("div",{className:"price",children:[s(k,{$design:x.header,as:"h2",className:"course-name",children:r.name}),s("div",{className:"price-details",children:w.formatCurrency(r.price.value,r.price.currency)})]}),s("hr",{className:"contact-separator"}),C?s(k,{$design:x.meta,className:"help",as:"div",children:s(S,{id:y.Help.Label,values:{contact(...l){return s(re,{href:`mailto:${C}`,children:l})}}})}):null]})}),s("article",{className:"payment",children:e.match.params.claimId||d?s(he,{claimId:e.match.params.claimId,courseId:r.id,loginEmail:d,navigateToCourse:f,mode:I}):s(be,{user:u,course:r,navigateToCourse:f,onLoginNeeded:N})})]})}const ye=J(["body{margin:0;}*,:after,:before{box-sizing:border-box;}"]),xe=Q.section.withConfig({componentId:"sc-io0swv-0"})(["display:flex;min-height:100vh;font-family:",";.items{padding:80px 5.4% 40px 0;flex:1;display:flex;flex-flow:column;align-items:flex-end;.price{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;}.price-details{font-size:20px;font-weight:bold;}}.payment{box-shadow:-16px 0 32px rgba(0,0,0,.1);padding:80px 53px 40px 53px;flex:1;}.headline{font-size:20px;margin-top:0;}.course-name{font-size:24px;}.img{display:flex;justify-content:center;--size:330px;img{width:var(--size);object-fit:contain;}}.help{color:#36394d;text-align:center;}@media (max-width:850px){&{flex-flow:column;}.details-container{display:grid;grid-template-columns:150px 1fr;grid-template-rows:1fr repeat(3,auto);}.img{--size:150px;grid-column:1;grid-row:1/-1;margin-right:20px;}.headline,.price,.contact-separator,.help{grid-column:2;}.headline{grid-row:1;margin:0;}.items .price{grid-row:2;align-items:baseline;}.contact-separator{width:100%;grid-row:3;}.help{grid-row:4;}.items{padding:10px;margin:15px;display:block;flex:0;}.payment{padding:20px;}.course-name{margin-bottom:5px;}.contact-separator:last-child{display:none;}}"],e=>e.$paragraph.fontFamily);export{Ee as default};
